(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-im-chat-im-list"],{"5e28":function(t,e,a){"use strict";(function(t){var i=a("4ea4");a("4160"),a("159b"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=i(a("5530")),n=a("2f62"),o=i(a("7d7d")),u={computed:(0,s.default)({},(0,n.mapState)(["hasLogin","loginProvider","nickname","avatar","receiveMessage","newFriendInvitiaon"])),data:function(){return{modalName:null,listTouchStart:0,listTouchDirection:null,loadModal:!1,lists:[]}},onShow:function(){this,this.getList()},onLoad:function(){uni.showLoading({title:"加载中...",mask:!0})},onReady:function(){uni.hideLoading()},onPullDownRefresh:function(){this.getList()},watch:{receiveMessage:function(e){t.log("监听到新消息，更新列表"),this.getList()}},methods:(0,s.default)((0,s.default)({},(0,n.mapMutations)(["login"])),{},{ListTouchStart:function(t){this.listTouchStart=t.touches[0].pageX},ListTouchMove:function(t){this.listTouchDirection=t.touches[0].pageX-this.listTouchStart>0?"right":"left"},ListTouchEnd:function(t){"left"==this.listTouchDirection?this.modalName=t.currentTarget.dataset.target:this.modalName=null,this.listTouchDirection=null},deleteConversation:function(t){var e=this;this.loadModal=!0;var a=this.lists[t],i={type:a.conversationType};"group"==a.conversationType?i.groupId=a.target.id:"single"==a.conversationType&&(i.username=a.target.username),this.jpushIM.deleteConversation(i,(function(t){setTimeout((function(){e.loadModal=!1}),2e3),0==t.errorCode?e.getList():uni.showModal({title:"删除失败",content:"原因："+t.errorMsg,showCancel:!1,cancelText:"",confirmText:"关闭"})}))},getList:function(){uni.stopPullDownRefresh();var t=this.$queue.getData("userId");if(!t)return uni.showModal({title:"错误",content:"还未登录，请先登录",showCancel:!0,cancelText:"先看看",confirmText:"登录",success:function(t){t.confirm&&uni.navigateTo({url:"../public/login"}),t.cancel&&uni.switchTab({url:"../index/index"})},fail:function(){},complete:function(){}}),!1;var e=this.setList(o.default.imList);this.lists=e},setList:function(t){var e=this,a=[];return t.forEach((function(t){t&&(t.latestMessage?("image"==t.latestMessage.messageType?t.lastMessageText="[图片]":"voice"==t.latestMessage.messageType?t.lastMessageText="[语音]":t.lastMessageText=t.latestMessage.messageString,t.lastMessageTime=e.imUtils.fromTimer(t.latestMessage.createTime),t.messageType=t.latestMessage.messageType):(t.lastMessageText="",t.lastMessageTime="",t.messageType=""),"single"==t.conversationType?t.avatar=t.target.avatar?t.target.avatar:"../../static/img/im/chat_icon.png":"group"==t.conversationType&&(t.avatar="../../static/img/im/chat_icon_group.jpg"),a.push(t))})),a},skipToSingleChat:function(t){var e=this.lists[t];e.nickname,e.nickname;if("single"==e.conversationType){var a=e.target.nickname?e.target.nickname:e.target.username;uni.navigateTo({url:"im-chat?title="+a+"&fromUser="+e.target.username})}else"group"==e.conversationType&&uni.navigateTo({url:"./im-chat-group?groupId="+e.target.id+"&title="+e.target.name})}})};e.default=u}).call(this,a("5a52")["default"])},"84f6":function(t,e,a){"use strict";var i;a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){return i}));var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("v-uni-view",{staticClass:"padding"},[a("v-uni-view",{staticClass:"cu-capsule round flex justify-center"},[a("v-uni-view",{staticClass:"cu-tag bg-orange",staticStyle:{"font-size":"15px",padding:"6rpx 30rpx"}},[t._v("会话列表")]),a("v-uni-navigator",{staticClass:"cu-tag line-orange",staticStyle:{"font-size":"15px",padding:"6rpx 30rpx"},attrs:{url:"../group-list/group-list"}},[t._v("群聊列表")])],1)],1),a("v-uni-view",{staticClass:"cu-list menu-avatar"},t._l(t.lists,(function(e,i){return a("v-uni-view",{key:i,staticClass:"cu-item",class:t.modalName=="move-box-"+i?"move-cur":"",attrs:{"data-target":"move-box-"+i},on:{touchstart:function(e){arguments[0]=e=t.$handleEvent(e),t.ListTouchStart.apply(void 0,arguments)},touchmove:function(e){arguments[0]=e=t.$handleEvent(e),t.ListTouchMove.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=t.$handleEvent(e),t.ListTouchEnd.apply(void 0,arguments)},click:function(e){arguments[0]=e=t.$handleEvent(e),t.skipToSingleChat(i)}}},[a("v-uni-view",{staticClass:"cu-avatar round lg",style:[{backgroundImage:"url("+e.avatar+")"}]}),a("v-uni-view",{staticClass:"content"},[a("v-uni-view",{staticClass:"text-grey"},[t._v(t._s(e.title))]),a("v-uni-view",{staticClass:"text-gray text-sm"},["event"==e.messageType?a("v-uni-text",{staticClass:"cuIcon-infofill text-red  margin-right-xs"}):t._e(),t._v(t._s(e.lastMessageText))],1)],1),a("v-uni-view",{staticClass:"action",staticStyle:{width:"200rpx"}},[a("v-uni-view",{staticClass:"text-grey text-xs"},[t._v(t._s(e.lastMessageTime))]),e.unreadCount?a("v-uni-view",{staticClass:"cu-tag round bg-red sm"},[t._v(t._s(e.unreadCount))]):t._e()],1),a("v-uni-view",{staticClass:"move"},[a("v-uni-view",{staticClass:"bg-red",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.deleteConversation(i)}}},[t._v("删除")])],1)],1)})),1),t.loadModal?a("v-uni-view",{staticClass:"cu-load load-modal"},[a("v-uni-view",{staticClass:"cuIcon-emojifill text-orange"}),a("v-uni-view",{staticClass:"gray-text"},[t._v("加载中...")])],1):t._e()],1)},n=[]},b875:function(t,e,a){"use strict";a.r(e);var i=a("84f6"),s=a("cd0e");for(var n in s)"default"!==n&&function(t){a.d(e,t,(function(){return s[t]}))}(n);var o,u=a("f0c5"),c=Object(u["a"])(s["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],o);e["default"]=c.exports},cd0e:function(t,e,a){"use strict";a.r(e);var i=a("5e28"),s=a.n(i);for(var n in i)"default"!==n&&function(t){a.d(e,t,(function(){return i[t]}))}(n);e["default"]=s.a}}]);